<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Online Bookstore</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="stylesheet" href="style.css">
  <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;700&display=swap" rel="stylesheet">
  <style>
    .modal {display:none;position:fixed;z-index:1000;left:0;top:0;width:100%;height:100%;background:rgba(24,28,42,.5);}
    .modal-content {animation:pop .3s ease; margin:7% auto; background:#fff; padding:2.2rem 2rem 1.8rem 2rem; border-radius:1.2rem; width:340px; text-align:center; box-shadow:0 6px 50px #00000035; position:relative;}
    .close { position:absolute; right:24px; top:16px; font-size:2rem; cursor:pointer; color:#900;}
    @keyframes pop {0%{transform:scale(.7);opacity:.3;} 80%{transform:scale(1.03);} 100%{transform:scale(1);opacity:1;}}
    .modal-content input, .modal-content button {
      width:92%;padding:0.9rem;margin:0.7rem 0;border-radius:0.7rem;
      border:1px solid #d1d5db;font-size:1.08rem;}
    .modal-content button {
      background:linear-gradient(90deg,#7d5fff 70%,#4fa3f7);color:#fff;
      font-weight:600;border:none;cursor:pointer;transition:background .3s;}
    .modal-content button:hover {background:#4fa3f7;}
    #loginBtn {margin-left:10px;background:#7d5fff;text-transform:uppercase;color:#fff;font-weight:bold;border:none;padding:0.7rem 1.2rem;border-radius:0.8rem;font-size:1rem;cursor:pointer;transition:.2s;}
    #loginBtn.loggedin {background:#29bf12;}
    #signinMessage, #signupMessage {margin-top:.6rem;color:#e53e3e;}


#profileBtn {
  background: #29bf12; color: #fff; border: none; padding: 0.7rem 1.2rem; border-radius: 0.8rem;
  font-size: 1rem; cursor: pointer; font-weight: bold; margin-left: 14px;
  position: relative; text-transform: uppercase;
}
#profileDropdown { transition:.2s; }
#profileBtn:focus + #profileDropdown, #profileDropdown:active, #profileDropdown:hover { display:block; }


  </style>
</head>
<body>
<header>
  <h1>Online Bookstore</h1>
  <nav>
    <button class="category-btn" data-category="All">All</button>
    <button class="category-btn" data-category="Fiction">Fiction</button>
    <button class="category-btn" data-category="Technology">Technology</button>
    <button class="category-btn" data-category="Children">Children</button>
  </nav>
  <button id="theme-toggle" title="Toggle Light/Dark Mode">üåô</button>
  <button id="profileBtn" style="display:none;">
    <span id="profileName"></span>
    <span id="profileTriangle" style="margin-left:6px;">‚ñº</span>
  </button>
  <button id="loginBtn">Login</button>

  <!-- Dropdown: initially hidden -->
  <div id="profileDropdown" style="
  display:none; position:absolute; right:38px; top:54px; background:#fff; border-radius:0.7rem;
  box-shadow:0 2px 12px #8884; padding:12px 18px; z-index:1001;">
    <button id="logoutBtn" style="background:#e53e3e;color:#fff;border:none;padding:7px 19px;border-radius:0.7rem;cursor:pointer;font-size:1rem;">
      Logout
    </button>
  </div>

</header>
<main>
  <section id="books-section"></section>
  <aside id="cart-section">
    <h2>Cart</h2>
    <div id="cart-items"></div>
    <div id="cart-total">Total: ‚Çπ0</div>
    <button id="purchaseButton">Buy Now</button>
  </aside>
</main>
<footer>
  <p>&copy; 2025 Online Bookstore &bull; Designed with ‚ù§Ô∏è</p>
</footer>

<!-- ----- Modals ----- -->
<!-- Login Modal -->
<div id="loginModal" class="modal">
  <div class="modal-content">
    <span class="close" id="closeLogin">&times;</span>
    <h2 style="margin-bottom:.6rem;">Sign In</h2>
    <form id="signinForm">
      <input type="text" id="signinUsername" placeholder="Username" required autofocus/>
      <input type="password" id="signinPassword" placeholder="Password" required/>
      <button type="submit">Sign In</button>
    </form>
    <div id="signinMessage"></div>
    <p style="margin-top:1rem;">New here? <a href="#" id="showSignUp" style="color:#7d5fff;font-weight:bold;">Create Account</a></p>
  </div>
</div>
<!-- Signup Modal -->
<div id="signupModal" class="modal">
  <div class="modal-content">
    <span class="close" id="closeSignup">&times;</span>
    <h2 style="margin-bottom:.6rem;">Create Your Account</h2>
    <form id="signupForm">
      <input type="text" id="signupUsername" placeholder="Username" required />
      <input type="password" id="signupPassword" placeholder="Password" required />
      <button type="submit">Sign Up</button>
    </form>
    <div id="signupMessage"></div>
  </div>
</div>

<script src="script.js"></script>
<script>
  let loggedInUser = null;

 // References
 const loginBtn = document.getElementById("loginBtn");
 const profileBtn = document.getElementById("profileBtn");
 const profileName = document.getElementById("profileName");
 const profileDropdown = document.getElementById("profileDropdown");
 const loginModal = document.getElementById("loginModal");
 const signupModal = document.getElementById("signupModal");

 // Modals: open/close
 loginBtn.onclick = () => { loginModal.style.display = "block"; };
 document.getElementById("closeLogin").onclick = () => {
   loginModal.style.display = "none";
   document.getElementById("signinMessage").innerText = "";
 };
 document.getElementById("closeSignup").onclick = () => {
   signupModal.style.display = "none";
   document.getElementById("signupMessage").innerText = "";
 };
 document.getElementById("showSignUp").onclick = (e) => {
   e.preventDefault();
   loginModal.style.display = "none";
   signupModal.style.display = "block";
 };

 // ------- Sign Up AJAX ------- //
 document.getElementById("signupForm").onsubmit = async function(e) {
   e.preventDefault();
   const username = document.getElementById("signupUsername").value;
   const password = document.getElementById("signupPassword").value;
   const res = await fetch('http://localhost:8080/api/auth/signup', {
     method: 'POST',
     headers: {'Content-Type': 'application/json'},
     body: JSON.stringify({username, password})
   });
   const msg = await res.text();
   if (msg.includes("successful")) {
     signupModal.style.display = "none";
     updateProfileUI(username);
     alert("Your account is created and you are logged in.");
   } else {
     document.getElementById("signupMessage").innerText = "Signup failed: " + msg;
   }
 };

 // ------- Sign In AJAX ------- //
 document.getElementById("signinForm").onsubmit = async function(e) {
   e.preventDefault();
   const username = document.getElementById("signinUsername").value;
   const password = document.getElementById("signinPassword").value;
   const res = await fetch('http://localhost:8080/api/auth/signin', {
     method: 'POST',
     headers: {'Content-Type': 'application/json'},
     body: JSON.stringify({username, password})
   });
   const msg = await res.text();
   if (msg.includes("successful")) {
     loginModal.style.display = "none";
     updateProfileUI(username);
     alert("You have successfully signed in!");
   } else {
     document.getElementById("signinMessage").innerText = "Incorrect username or password. Redirecting to Sign Up...";
     setTimeout(() => {
       loginModal.style.display = "none";
       signupModal.style.display = "block";
       document.getElementById("signupUsername").value = username;
     }, 1500);
   }
 };

 // ------ Update Profile UI and Dropdown ------ //
 function updateProfileUI(username) {
   loggedInUser = username;
   profileBtn.style.display = "inline-block";
   loginBtn.style.display = "none";
   profileName.textContent = username;
 }

 // --- Profile Dropdown show/hide --- //
 profileBtn.onclick = function(e) {
   e.stopPropagation();
   profileDropdown.style.display = (profileDropdown.style.display === "block") ? "none" : "block";
 };
 document.body.onclick = () => { profileDropdown.style.display = "none"; };

 // ------ Logout function ------ //
 document.getElementById("logoutBtn").onclick = function() {
   loggedInUser = null;
   profileBtn.style.display = "none";
   loginBtn.style.display = "inline-block";
   document.getElementById("cart-items").innerHTML = "";
   document.getElementById("cart-total").textContent = "Total: ‚Çπ0";
   alert("Logged out!");
   profileDropdown.style.display = "none";
 };

 // -------- Buy Button Protection -------- //
 document.getElementById("purchaseButton").onclick = function() {
   if (!loggedInUser) {
     loginModal.style.display = "block";
     alert("Please log in to make purchases.");
   } else {
     alert("Your purchase is successfully done!");
     // Place your real purchase logic here
   }
 };

</script>
</body>
</html>
